/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var D=(l,r)=>{for(var e in r)y(l,e,{get:r[e],enumerable:!0})},A=(l,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of I(r))!P.call(l,s)&&s!==e&&y(l,s,{get:()=>r[s],enumerable:!(t=H(r,s))||t.enumerable});return l};var W=l=>A(y({},"__esModule",{value:!0}),l);var k={};D(k,{default:()=>S});module.exports=W(k);var g=require("obsidian");var F=class{constructor(r,e,t){let{nodesPerRow:s,nodeWidth:a,nodeHeight:i,nodeSpacing:d,selectedHeading:n}=t;this.id=`node-${r}`,this.x=r%s*(a+d),this.y=Math.floor(r/s)*(i+d),this.width=a,this.height=i,this.type="file",this.file=e,this.subpath=n?`#${n}`:void 0}toJSON(){return{id:this.id,x:this.x,y:this.y,width:this.width,height:this.height,type:this.type,file:this.file,subpath:this.subpath}}},v=F;var p=require("obsidian");var u=l=>{let r=l.replace(".canvas","").match(/^(.*?)(?: (\d+))?$/);if(!r)throw new Error("Invalid filename format");return{baseName:r[1],number:r[2]?parseInt(r[2]):null,ext:".canvas"}},f=l=>l.endsWith(".canvas")?l:`${l}.canvas`;function M(l,r){let e=this.app.vault.getFolderByPath(l);if(!e)return[];let t=[],s=a=>{var i;a instanceof p.TFile?a.extension==="canvas"&&a.path.includes(r)&&t.push(a):(i=a.children)==null||i.forEach(d=>s(d))};return s(e),t}function O(l,r){let e=f(r),t=u(e),s=M(l,t.baseName),a=0;s.forEach(d=>{var o;a=(o=u(d.name).number)!=null?o:1});let i=a===0?e:`${t.baseName} ${a+1}${t.ext}`;return`${l}/${i}`}async function b(l,r,e,t,s){if(e.length===0){new p.Notice("The folder is empty!");return}let a=O(r,t),i={nodes:await Promise.all(e.map(async(n,o)=>{try{let E=(await l.vault.read(n)).split(`
`).filter(w=>w.trim().match(/^#+\s+/)).map(w=>w.replace(/^#+\s*/,"")),N={...s};return E.includes(s.selectedHeading)||(N.selectedHeading=""),new v(o,n.path,N)}catch(h){return console.log(h),null}})),edges:[]},d=await l.vault.create(a,JSON.stringify(i,null,2));s.openOnCreate&&await l.workspace.openLinkText(a,"",!0),d?new p.Notice(`Canvas created at ${a}`):new p.Notice("Failed to create a Canvas file.")}var m=require("obsidian"),C=class extends m.SuggestModal{constructor(e,t){super(e);this.onSelect=t}getSuggestions(e){let t=[],s=i=>{t.push(i),i.children.forEach(d=>{d instanceof m.TFolder&&s(d)})},a=this.app.vault.getRoot().children.filter(i=>i instanceof m.TFolder);for(let i of a)s(i);return t.filter(i=>i.path.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.path})}onChooseSuggestion(e){this.onSelect(e)}};var c={nodesPerRow:4,openOnCreate:!0,canvasFileName:`Canvas-${Date.now()}.canvas`,watchFolder:!0,nodeWidth:250,nodeHeight:100,nodeSpacing:20,maxWidth:1e3,maxHeight:1e3,maxSpacing:100,selectedHeading:"",hideHeadingTitles:!1},R="foldercanvas",x="generate-canvas-from-folder",$="Generate Canvas from folder",L=`${R}:${x}`,S=class extends g.Plugin{constructor(){super(...arguments);this.cssEl=null}async onload(){await this.loadSettings(),this.settings.hideHeadingTitles&&this.applyCSSStyle(),this.addRibbonIcon("palette","Folder Canvas",e=>this.triggerCommandById()),this.addSettingTab(new T(this.app,this)),this.addCommand({id:x,name:$,callback:async()=>{new C(this.app,async e=>{try{await this.generateCanvas(e)}catch(t){new g.Notice("Failed to generate a Canvas file. Please try again."),console.error(t)}}).open()}}),this.registerEvent(this.app.workspace.on("editor-menu",(e,t,s)=>{e.addItem(a=>{a.setTitle("Generate a Canvas view").setIcon("palette").onClick(async()=>this.triggerCommandById())})})),this.registerEvent(this.app.workspace.on("file-menu",(e,t)=>{e.addItem(s=>{s.setTitle("Generate a Canvas view").setIcon("palette").onClick(async()=>this.triggerCommandById())})})),this.app.workspace.onLayoutReady(()=>{this.registerEvent(this.app.vault.on("create",async e=>{e instanceof g.TFile&&e.extension==="md"&&setTimeout(()=>this.updateCanvas("add",e),100)})),this.registerEvent(this.app.vault.on("delete",async e=>{e instanceof g.TFile&&e.extension==="md"&&this.updateCanvas("remove",e)})),this.registerEvent(this.app.vault.on("rename",async(e,t)=>{e instanceof g.TFile&&e.extension==="md"&&setTimeout(()=>this.updateCanvas("rename",e,t),100)}))})}async onunload(){this.removeCSSStyle()}async loadSettings(){this.settings=Object.assign({},c,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async generateCanvas(e){let t=this.settings.canvasFileName,s=e.children.filter(a=>a instanceof g.TFile&&a.extension==="md");await b(this.app,e.path,s,t,this.settings)}async getCurrentCanvasFile(e){let t=e.path.split("/")[0],s=this.app.vault.getFolderByPath(t);if(!s)return;let a=[],i=d=>{var n;if(d instanceof g.TFile){let o=f(this.settings.canvasFileName),h=u(o);d.extension==="canvas"&&d.path.includes(h.baseName)&&a.push(d)}else(n=d.children)==null||n.forEach(o=>i(o))};return i(s),a==null?void 0:a.pop()}async updateCanvas(e,t,s){if(!this.settings.watchFolder)return;let a=await this.getCurrentCanvasFile(t);if(!a)return;let i=JSON.parse(await this.app.vault.read(a));if(e==="add"){if(a.parent){let d=a.parent.children.filter(o=>o.extension==="md").length,n=new v(d,t.path,this.settings);i.nodes.push(n.toJSON())}}else e==="remove"?i.nodes=i.nodes.filter(d=>!d.file.endsWith(t.path)):e==="rename"&&s&&i.nodes.forEach(d=>{d.file===s&&(d.file=t.path)});await this.app.vault.modify(a,JSON.stringify(i,null,2)),new g.Notice("Canvas updated.")}async triggerCommandById(){this.app.commands.executeCommandById(L)}async getHeadings(){let e=this.app.workspace.getActiveFile();return e?new Promise(t=>{this.app.vault.read(e).then(s=>{let a=s.split(`
`).filter(i=>i.trim().match(/^#+\s+/)).map(i=>i.replace(/^#+\s*/,""));t(a)})}):[]}applyCSSStyle(){this.cssEl||(this.cssEl=document.createElement("style"),this.cssEl.textContent=`.inline-title.markdown-rendered { 
			color: transparent; 
			height: 0;
		}`,document.head.appendChild(this.cssEl))}removeCSSStyle(){this.cssEl&&(this.cssEl.remove(),this.cssEl=null)}toggleCSSStyle(e){e?this.applyCSSStyle():this.removeCSSStyle()}},T=class extends g.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}async display(){let{containerEl:e}=this;e.empty(),new g.Setting(e).setName("Canvas filename pattern").setDesc("Specify the default filename for a new canvas. (Cannot contain '/' or '\\')").addText(n=>n.setPlaceholder("Canvas-<Date>.canvas").setValue(this.plugin.settings.canvasFileName).onChange(async o=>{/[\\/]/.test(o)?(new g.Notice("Invalid characters: '/' and '\\' are not allowed."),n.setValue(this.plugin.settings.canvasFileName)):(this.plugin.settings.canvasFileName=o||c.canvasFileName,await this.plugin.saveSettings())})),new g.Setting(e).setName("Open Canvas on creation").setDesc("Automatically open the new Canvas file after it is created.").addToggle(n=>n.setValue(this.plugin.settings.openOnCreate).onChange(async o=>{this.plugin.settings.openOnCreate=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("Watch Canvas folder").setDesc("Automatically update the Canvas when files are added or removed from the folder.").addToggle(n=>n.setValue(this.plugin.settings.watchFolder).onChange(async o=>{this.plugin.settings.watchFolder=o,await this.plugin.saveSettings()}));let t=new g.Setting(e).setName(`Nodes per row: ${this.plugin.settings.nodesPerRow}`).setDesc("Number of nodes to display per row in the Canvas.").addSlider(n=>n.setLimits(1,10,1).setValue(this.plugin.settings.nodesPerRow).onChange(async o=>{this.plugin.settings.nodesPerRow=o,await this.plugin.saveSettings(),t.setName(`Nodes per row: ${o}`)})),s;new g.Setting(e).setName("Node width").setDesc("Set the width of nodes (default: 250, max: 1000).").addText(n=>{n.setValue(this.plugin.settings.nodeWidth.toString()).onChange(async o=>{let h=this.validateInput(o,this.plugin.settings.maxWidth);this.plugin.settings.nodeWidth=h,await this.plugin.saveSettings()}),s=n.inputEl}).addButton(n=>{n.setButtonText("Reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.nodeWidth=c.nodeWidth,await this.plugin.saveSettings(),s.value=c.nodeWidth.toString()})});let a;new g.Setting(e).setName("Node height").setDesc("Set the height of nodes (default: 100, max: 1000).").addText(n=>{n.setValue(this.plugin.settings.nodeHeight.toString()).onChange(async o=>{let h=this.validateInput(o,this.plugin.settings.maxWidth);this.plugin.settings.nodeHeight=h,await this.plugin.saveSettings()}),a=n.inputEl}).addButton(n=>{n.setButtonText("Reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.nodeHeight=c.nodeHeight,await this.plugin.saveSettings(),a.value=c.nodeHeight.toString()})});let i;new g.Setting(e).setName("Node spacing").setDesc("Set the spacing between nodes (default: 20, max: 100).").addText(n=>{n.setValue(this.plugin.settings.nodeSpacing.toString()).onChange(async o=>{let h=this.validateInput(o,this.plugin.settings.maxWidth);this.plugin.settings.nodeSpacing=h,await this.plugin.saveSettings()}),i=n.inputEl}).addButton(n=>{n.setButtonText("Reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.nodeSpacing=c.nodeSpacing,await this.plugin.saveSettings(),i.value=c.nodeSpacing.toString()})});let d=await this.plugin.getHeadings();new g.Setting(e).setName("Narrow to heading").setDesc("Choose a heading from the active file to apply to all nodes in a Canvas file.").addDropdown(n=>{n.addOption("","Select a heading"),d.forEach(o=>n.addOption(o,o)),n.setValue(this.plugin.settings.selectedHeading),n.onChange(async o=>{this.plugin.settings.selectedHeading=o,await this.plugin.saveSettings()})}),new g.Setting(e).setName("Hide heading titles").setDesc("Toggle to hide heading titles by applying custom CSS styling.").addToggle(n=>{n.setValue(this.plugin.settings.hideHeadingTitles||!1).onChange(async o=>{this.plugin.settings.hideHeadingTitles=o,await this.plugin.saveSettings(),this.plugin.toggleCSSStyle(o)})})}validateInput(e,t){let s=parseInt(e,10);return isNaN(s)&&(s=0),Math.min(s,t)}};

/* nosourcemap */